---
title: "Intro to Machine Learning (STA380) - Part 2 Exercises"
author: "Satya Pal"
date: "15/08/2021"
output: github_document
---

##Problem 2: Visual story telling part 2: flights at ABIA

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(ggplot2)
library(ggrepel)
```

```{r include = FALSE}
ABIA = read.csv("ABIA.csv")
ABIA$Cancelled = as.factor(ABIA$Cancelled)
ABIA$DayOfWeek = as.factor(ABIA$DayOfWeek)
```

I would like to start this part with an anecdote. While I was traveling from India to the US for joining the Masters program, I booked a flight which was supposed to fly out from India at 11:45PM and land in the US in morning. Unfortunately, the flight got delayed by 8 hours and it would now fly out at 7:30 in the morning and land in the US in the middle of the night. Not only I was sleepless for more than two days but also I missed my connecting flight to Austin and could not attend my classes for two days. If a few hours delay messes up with a person's plans this much, imagine what a flight cancellation can do to someone's plans. If only someone knows that which carrier on which day of the week and time has a higher chance of a flight getting cancelled, someone can plan better. 

Here is a plot to see which day of the week is the worst in terms of flight cancellation. 

```{r echo = FALSE}
cancelled_flights = ABIA[ABIA$Cancelled == 1,]
table(cancelled_flights$UniqueCarrier)
group = ABIA %>%
  group_by(DayOfWeek, UniqueCarrier)  %>% 
  summarize(count = sum(Cancelled == 1), .groups = 'drop')
ggplot(data = group, aes(x = DayOfWeek, y = count, fill = DayOfWeek)) +
        geom_bar(stat = 'identity') + 
        facet_wrap(~UniqueCarrier) +
        scale_fill_brewer(palette = "Accent") +
        labs(title = "Airline Flight Cancellations (in a Week)") + xlab("Day of Week") + ylab("# Flights Cancelled") +
        theme(legend.position = "none")
```

As mentioned in the description, we now should see what time of the day the flights get cancelled more in order to avoid that. 

```{r echo = FALSE}
ABIA['dep_time'] = as.integer(ABIA$CRSDepTime / 100)
ABIA['dep_time_period'] = ifelse(ABIA$dep_time >=0 & ABIA$dep_time < 12, 'Morning', ifelse(ABIA$dep_time >= 12 & ABIA$dep_time < 16, 'Afternoon', ifelse(ABIA$dep_time >=14 & ABIA$dep_time < 20, 'Evening', 'Night')))                  
ABIA$dep_time = as.factor(ABIA$dep_time)
ABIA$dep_time_period = as.factor(ABIA$dep_time_period)
group = ABIA %>%
  group_by(dep_time_period, UniqueCarrier)  %>% 
  summarize(count = sum(Cancelled == 1) / sum(UniqueCarrier == UniqueCarrier), .groups = 'drop')
ggplot(data = group, aes(x = dep_time_period, y = count, fill = dep_time_period)) +
        geom_bar(stat = 'identity') + 
        facet_wrap(~UniqueCarrier) + 
        scale_fill_brewer(palette = "YlGnBu")+
        coord_flip()  +
        labs(title = "Airline Flight Cancellations (in a Day)") + xlab("Time of Day") + ylab("% Flights Cancelled") +
        theme(legend.position = "none")
```

We can see that out of 12 airlines, only Northwest Airlines did not have any cancellations.

Finally, the cancellation codes. 

```{r echo = FALSE}
group = ABIA %>%
  group_by(dep_time_period, CancellationCode)  %>% 
  summarize(count = sum(Cancelled == 1), .groups = 'drop')
ggplot(data = group[-c(1,5,9,13),], aes(x = dep_time_period, y = count, fill = dep_time_period)) +
        geom_bar(stat = 'identity') +
        scale_fill_brewer(palette = "Spectral")+
        facet_wrap(~CancellationCode) + 
        #coord_flip()  +
        labs(title = "Cancellation Codes (A,B,C during a day)") + xlab("Time of Day") + ylab("# Cancelled Flights") +
        theme(legend.position = "none")
```
